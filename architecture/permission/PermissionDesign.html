<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/logo.png"><title>位运算和权限设计 | 海涛 Blog</title><meta name="description" content="海涛的前端笔记">
    <link rel="modulepreload" href="/assets/app.a35418cc.js"><link rel="modulepreload" href="/assets/PermissionDesign.html.fa39f56f.js"><link rel="modulepreload" href="/assets/PermissionDesign.html.d9fe3f0b.js"><link rel="prefetch" href="/assets/index.html.4ce41837.js"><link rel="prefetch" href="/assets/ChineseTypesetting.html.4f8b3c8c.js"><link rel="prefetch" href="/assets/VuePress.html.c82136ff.js"><link rel="prefetch" href="/assets/OAuth2.0.html.cec93401.js"><link rel="prefetch" href="/assets/TokenRefresh.html.427c8dc6.js"><link rel="prefetch" href="/assets/Gitflow流程规范.html.48e4ee3b.js"><link rel="prefetch" href="/assets/index.html.02ee56da.js"><link rel="prefetch" href="/assets/Ajax.html.39aa375e.js"><link rel="prefetch" href="/assets/async_await.html.921458c1.js"><link rel="prefetch" href="/assets/Promise.html.d07795bd.js"><link rel="prefetch" href="/assets/index.html.17ac6410.js"><link rel="prefetch" href="/assets/浅拷贝与深拷贝.html.f5090530.js"><link rel="prefetch" href="/assets/Express中间件.html.b2ceba4b.js"><link rel="prefetch" href="/assets/Express编写接口.html.f171c70e.js"><link rel="prefetch" href="/assets/Express路由.html.5f9fcbc0.js"><link rel="prefetch" href="/assets/fs文件系统模块.html.607612ea.js"><link rel="prefetch" href="/assets/http模块.html.7f15569c.js"><link rel="prefetch" href="/assets/mysql模块.html.3b666967.js"><link rel="prefetch" href="/assets/path路径模块.html.2f137f0b.js"><link rel="prefetch" href="/assets/index.html.50f93394.js"><link rel="prefetch" href="/assets/初识Express.html.d2c3d386.js"><link rel="prefetch" href="/assets/身份认证.html.69c0138d.js"><link rel="prefetch" href="/assets/项目搭建.html.185bdd7d.js"><link rel="prefetch" href="/assets/index.html.2b33a595.js"><link rel="prefetch" href="/assets/其他.html.92b1fb3f.js"><link rel="prefetch" href="/assets/函数.html.53278502.js"><link rel="prefetch" href="/assets/基础类型.html.646e950b.js"><link rel="prefetch" href="/assets/安装.html.0c5d0a3a.js"><link rel="prefetch" href="/assets/接口.html.b29864da.js"><link rel="prefetch" href="/assets/泛型.html.efc74347.js"><link rel="prefetch" href="/assets/类.html.b94ab512.js"><link rel="prefetch" href="/assets/CompositionAPI的优势.html.9b062c5b.js"><link rel="prefetch" href="/assets/index.html.2086140f.js"><link rel="prefetch" href="/assets/其他.html.f5f82351.js"><link rel="prefetch" href="/assets/其他CompositionAPI.html.c5c80c4d.js"><link rel="prefetch" href="/assets/创建Vue3项目.html.8e5d2b4c.js"><link rel="prefetch" href="/assets/常用CompositionAPI.html.68394e4c.js"><link rel="prefetch" href="/assets/新的组件.html.547072a7.js"><link rel="prefetch" href="/assets/404.html.c3e557d0.js"><link rel="prefetch" href="/assets/index.html.63668cd6.js"><link rel="prefetch" href="/assets/ChineseTypesetting.html.6a1ce612.js"><link rel="prefetch" href="/assets/VuePress.html.bf72b9cf.js"><link rel="prefetch" href="/assets/OAuth2.0.html.366d8a06.js"><link rel="prefetch" href="/assets/TokenRefresh.html.c77b7cb7.js"><link rel="prefetch" href="/assets/Gitflow流程规范.html.b0481665.js"><link rel="prefetch" href="/assets/index.html.926709cc.js"><link rel="prefetch" href="/assets/Ajax.html.942a6957.js"><link rel="prefetch" href="/assets/async_await.html.1a04473e.js"><link rel="prefetch" href="/assets/Promise.html.89753f63.js"><link rel="prefetch" href="/assets/index.html.7834239b.js"><link rel="prefetch" href="/assets/浅拷贝与深拷贝.html.eb9740fb.js"><link rel="prefetch" href="/assets/Express中间件.html.291f1aa5.js"><link rel="prefetch" href="/assets/Express编写接口.html.82bd20d9.js"><link rel="prefetch" href="/assets/Express路由.html.92c3871c.js"><link rel="prefetch" href="/assets/fs文件系统模块.html.1102f79d.js"><link rel="prefetch" href="/assets/http模块.html.e14ac9d5.js"><link rel="prefetch" href="/assets/mysql模块.html.e2a5631e.js"><link rel="prefetch" href="/assets/path路径模块.html.c04f5711.js"><link rel="prefetch" href="/assets/index.html.43a7f823.js"><link rel="prefetch" href="/assets/初识Express.html.7fb68c03.js"><link rel="prefetch" href="/assets/身份认证.html.002c2fae.js"><link rel="prefetch" href="/assets/项目搭建.html.89b6942d.js"><link rel="prefetch" href="/assets/index.html.37726689.js"><link rel="prefetch" href="/assets/其他.html.e68d6ccf.js"><link rel="prefetch" href="/assets/函数.html.61fa75f7.js"><link rel="prefetch" href="/assets/基础类型.html.0472c8ba.js"><link rel="prefetch" href="/assets/安装.html.30ca8396.js"><link rel="prefetch" href="/assets/接口.html.4fad48f7.js"><link rel="prefetch" href="/assets/泛型.html.41dc99aa.js"><link rel="prefetch" href="/assets/类.html.6c639d9e.js"><link rel="prefetch" href="/assets/CompositionAPI的优势.html.87fa95e1.js"><link rel="prefetch" href="/assets/index.html.12a0d72f.js"><link rel="prefetch" href="/assets/其他.html.acd04014.js"><link rel="prefetch" href="/assets/其他CompositionAPI.html.ef57e6d9.js"><link rel="prefetch" href="/assets/创建Vue3项目.html.9dbc5013.js"><link rel="prefetch" href="/assets/常用CompositionAPI.html.32af462e.js"><link rel="prefetch" href="/assets/新的组件.html.c96f661c.js"><link rel="prefetch" href="/assets/404.html.994b8b19.js">
    <link rel="stylesheet" href="/assets/style.96ee71b5.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/logo.png" alt="海涛 Blog"><span class="site-name can-hide">海涛 Blog</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="知识体系"><span class="title">知识体系</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="知识体系"><span class="title">知识体系</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>基础</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/system/javascript/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/pages/system/typescript/01_简介" class="" aria-label="HTML&amp;CSS"><!--[--><!--]--> HTML&amp;CSS <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>扩展</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/system/typescript/" class="" aria-label="TypeScript"><!--[--><!--]--> TypeScript <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>框架</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/system/vue3/" class="" aria-label="Vue3"><!--[--><!--]--> Vue3 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>服务端</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/system/nodejs/" class="" aria-label="Node.js"><!--[--><!--]--> Node.js <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="架构设计"><span class="title">架构设计</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="架构设计"><span class="title">架构设计</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>权限控制</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/architecture/permission/OAuth2.0" class="" aria-label="OAuth 2.0"><!--[--><!--]--> OAuth 2.0 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/architecture/permission/TokenRefresh" class="" aria-label="Token 刷新"><!--[--><!--]--> Token 刷新 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/architecture/permission/PermissionDesign" class="router-link-active" aria-label="权限设计"><!--[--><!--]--> 权限设计 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="其他"><span class="title">其他</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="其他"><span class="title">其他</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>开发工具</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/other/git/" class="" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>风格指南</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/other/ChineseTypesetting" class="" aria-label="中文排版"><!--[--><!--]--> 中文排版 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>博客搭建</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/other/VuePress" class="" aria-label="VuePress"><!--[--><!--]--> VuePress <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/haitaoyu" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="搜索文档" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="知识体系"><span class="title">知识体系</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="知识体系"><span class="title">知识体系</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>基础</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/system/javascript/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/pages/system/typescript/01_简介" class="" aria-label="HTML&amp;CSS"><!--[--><!--]--> HTML&amp;CSS <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>扩展</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/system/typescript/" class="" aria-label="TypeScript"><!--[--><!--]--> TypeScript <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>框架</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/system/vue3/" class="" aria-label="Vue3"><!--[--><!--]--> Vue3 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>服务端</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/system/nodejs/" class="" aria-label="Node.js"><!--[--><!--]--> Node.js <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="架构设计"><span class="title">架构设计</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="架构设计"><span class="title">架构设计</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>权限控制</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/architecture/permission/OAuth2.0" class="" aria-label="OAuth 2.0"><!--[--><!--]--> OAuth 2.0 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/architecture/permission/TokenRefresh" class="" aria-label="Token 刷新"><!--[--><!--]--> Token 刷新 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/architecture/permission/PermissionDesign" class="router-link-active" aria-label="权限设计"><!--[--><!--]--> 权限设计 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="其他"><span class="title">其他</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="其他"><span class="title">其他</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>开发工具</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/other/git/" class="" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>风格指南</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/other/ChineseTypesetting" class="" aria-label="中文排版"><!--[--><!--]--> 中文排版 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>博客搭建</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/other/VuePress" class="" aria-label="VuePress"><!--[--><!--]--> VuePress <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/haitaoyu" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">位运算和权限设计 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/architecture/permission/PermissionDesign.html#_1-内容摘要" class="router-link-active router-link-exact-active sidebar-item" aria-label="1. 内容摘要"><!--[--><!--]--> 1. 内容摘要 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/architecture/permission/PermissionDesign.html#_2-number" class="router-link-active router-link-exact-active sidebar-item" aria-label="2. Number"><!--[--><!--]--> 2. Number <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/architecture/permission/PermissionDesign.html#_3-位运算" class="router-link-active router-link-exact-active sidebar-item" aria-label="3. 位运算"><!--[--><!--]--> 3. 位运算 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/architecture/permission/PermissionDesign.html#_4-位运算在权限系统中的运用" class="router-link-active router-link-exact-active sidebar-item" aria-label="4. 位运算在权限系统中的运用"><!--[--><!--]--> 4. 位运算在权限系统中的运用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/architecture/permission/PermissionDesign.html#_5-局限性和解决办法" class="router-link-active router-link-exact-active sidebar-item" aria-label="5. 局限性和解决办法"><!--[--><!--]--> 5. 局限性和解决办法 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/architecture/permission/PermissionDesign.html#_6-适用场景和问题" class="router-link-active router-link-exact-active sidebar-item" aria-label="6. 适用场景和问题"><!--[--><!--]--> 6. 适用场景和问题 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/architecture/permission/PermissionDesign.html#_7-其他方案" class="router-link-active router-link-exact-active sidebar-item" aria-label="7. 其他方案"><!--[--><!--]--> 7. 其他方案 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="位运算和权限设计" tabindex="-1"><a class="header-anchor" href="#位运算和权限设计" aria-hidden="true">#</a> 位运算和权限设计</h1><h2 id="_1-内容摘要" tabindex="-1"><a class="header-anchor" href="#_1-内容摘要" aria-hidden="true">#</a> 1. 内容摘要</h2><p>本文主要讨论以下两个问题：</p><ul><li><p>JavaScript 的位运算。</p></li><li><p>根据位运算的特点，设计一个权限系统（添加、删除、判断等）。</p></li></ul><br><h2 id="_2-number" tabindex="-1"><a class="header-anchor" href="#_2-number" aria-hidden="true">#</a> 2. Number</h2><p>在探究位运算之前，首先简单看下 JavaScript 中的 <code>Number</code>。</p><p>在 JavaScript 里，数字均为基于 IEEE 754 标准的双精度 64 位的浮点数，它的结构是这样的：</p><p><img src="https://raw.githubusercontent.com/haitaoyu/blog-pictures/main/imgs/202209060955969.png" alt="20190918235556672"></p><ul><li><p>sign bit（符号）：用来表示正负号。</p></li><li><p>exponent（指数）：用来表示次方数。</p></li><li><p>mantissa（尾数）：用来表示精确度。</p></li></ul><p>也就是说一个数字的范围只能在 <code>-(2^53 - 1)</code> 至 <code>2^53 - 1</code> 之间。</p><div class="custom-container tip"><p class="custom-container-title">补充</p><p><code>0.1 + 0.2</code> 之类的算不准的原因也在于此。浮点数用二进制表达时是有穷的，且最多 53 位，必须截断，进而产生误差。</p><p>最简单的解决办法就是放大一定倍数变成整数，计算完成后再缩小。不过更稳妥的办法是使用 math.js 等工具库。</p></div><p><code>Number</code> 有 4 种进制：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 十进制</span>
<span class="token number">123456789</span>
<span class="token number">0</span>

<span class="token comment">// 二进制：前缀 0b，0B</span>
<span class="token number">0b10000000000000000000000000000000</span> <span class="token comment">// 2147483648</span>
<span class="token number">0b01111111100000000000000000000000</span> <span class="token comment">// 2139095040</span>
<span class="token number">0B00000000011111111111111111111111</span> <span class="token comment">// 8388607</span>

<span class="token comment">// 八进制：前缀 0o</span>
<span class="token number">0o755</span> <span class="token comment">// 493</span>
<span class="token number">0o644</span> <span class="token comment">// 420</span>

<span class="token comment">// 十六进制：前缀 0x，0X</span>
<span class="token number">0xFFFFFFFFFFFFFFFFF</span> <span class="token comment">// 295147905179352830000</span>
<span class="token number">0x123456789ABCDEF</span>   <span class="token comment">// 81985529216486900</span>
<span class="token number">0XA</span>                 <span class="token comment">// 10</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><h2 id="_3-位运算" tabindex="-1"><a class="header-anchor" href="#_3-位运算" aria-hidden="true">#</a> 3. 位运算</h2><p>按位操作符将其操作数当作 32 位的比特序列（由 0 和 1 组成）操作，返回值依然是标准的 JavaScript 数值。</p><p>JavaScript 中的按位操作符有：</p><h3 id="按位与-and" tabindex="-1"><a class="header-anchor" href="#按位与-and" aria-hidden="true">#</a> 按位与（AND）</h3><ul><li><p>用法：<code>a &amp; b</code>。</p></li><li><p>描述：对于每一个比特位，只有两个操作数相应的比特位都是 1 时，结果才为 1，否则为 0。</p></li><li><p>示例：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">0b110</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">0b100</span>
<span class="token keyword">let</span> c <span class="token operator">=</span> a <span class="token operator">&amp;</span> b
c<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// output: &#39;100&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="按位或-or" tabindex="-1"><a class="header-anchor" href="#按位或-or" aria-hidden="true">#</a> 按位或（OR）</h3><ul><li><p>用法： <code>a | b</code>。</p></li><li><p>描述：对于每一个比特位，当两个操作数相应的比特位至少有一个 1 时，结果为 1，否则为 0。</p></li><li><p>示例：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">0b110</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">0b100</span>
<span class="token keyword">let</span> c <span class="token operator">=</span> a <span class="token operator">|</span> b 
c<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// output: &#39;110&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="按位异或-xor" tabindex="-1"><a class="header-anchor" href="#按位异或-xor" aria-hidden="true">#</a> 按位异或（XOR）</h3><ul><li><p>用法：<code>a ^ b</code>。</p></li><li><p>描述：对于每一个比特位，当两个操作数相应的比特位有且只有一个 1 时，结果为 1，否则为 0。</p></li><li><p>示例：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">0b110</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">0b100</span>
<span class="token keyword">let</span> c <span class="token operator">=</span> a <span class="token operator">^</span> b
c<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// output: &#39;10&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="按位非-not" tabindex="-1"><a class="header-anchor" href="#按位非-not" aria-hidden="true">#</a> 按位非（NOT）</h3><ul><li><p>用法：<code>~a</code> 。</p></li><li><p>描述：反转操作数的比特位，即 0 变成 1，1 变成 0。</p></li><li><p>示例：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">0b110</span>
<span class="token operator">~</span>a<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// output: &#39;-111&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="左移-left-shift" tabindex="-1"><a class="header-anchor" href="#左移-left-shift" aria-hidden="true">#</a> 左移（Left shift）</h3><ul><li><p>用法：<code>a &lt;&lt; b</code> 。</p></li><li><p>描述：将 a 的二进制形式向左移 b (&lt; 32) 比特位，右边用 0 填充。</p></li><li><p>示例：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">0b110</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">0</span><span class="token function">b100</span>
<span class="token punctuation">(</span>a <span class="token operator">&lt;&lt;</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>            <span class="token comment">// output: &#39;1100000&#39;</span>
<span class="token punctuation">(</span><span class="token number">0b1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0b11</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>       <span class="token comment">// outout: &#39;1000&#39;</span>
<span class="token punctuation">(</span><span class="token number">0b1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0b111</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>      <span class="token comment">// output: &#39;10000000&#39;</span>
<span class="token punctuation">(</span><span class="token number">0b1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0b1111</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>     <span class="token comment">// output: &#39;1000000000000000&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><br><h2 id="_4-位运算在权限系统中的运用" tabindex="-1"><a class="header-anchor" href="#_4-位运算在权限系统中的运用" aria-hidden="true">#</a> 4. 位运算在权限系统中的运用</h2><p>传统的权限系统里，存在很多关联关系，如：用户和权限的关联、用户和角色的关联。系统越大，关联关系越多，越难以维护。而引入位运算，可以巧妙的解决该问题。</p><p>首先，先假定两个前提，下文所有的讨论都是基于这两个前提的：</p><ul><li>每种权限码都是唯一的（这是显然的）。</li><li>所有权限码的二进制数形式，有且只有一位值为 1，其余全部为 0，也就是 <code>2^n</code>。</li></ul><br><p>如果用户权限和权限码，全部使用二级制数字表示，再结合上面 AND 和 OR 的例子，分析位运算的特点，不难发现：</p><ul><li><p><strong><code>|</code> 可以用来赋予权限。</strong></p></li><li><p><strong><code>&amp;</code> 可以用来校验权限。</strong></p></li></ul><br><p>为了更好理解，这里用 Linux 中的实例分析下，Linux 的文件权限分为读、写和执行，有字母和数字等多种表现形式：</p><table><thead><tr><th>权限</th><th>字母表示</th><th>数字表示</th><th>二进制</th></tr></thead><tbody><tr><td>读</td><td>r</td><td>4</td><td>0b100</td></tr><tr><td>写</td><td>w</td><td>2</td><td>0b010</td></tr><tr><td>执行</td><td>x</td><td>1</td><td>0b001</td></tr></tbody></table><p>可以看到，权限用 1、2、4（也就是 <code>2^n</code>）表示，转换为二进制后，都是只有一位是 1，其余为 0。</p><br><p>通过下面几个例子，看一下如何利用二进制的特点执行权限的添加、校验和删除。</p><h3 id="添加权限" tabindex="-1"><a class="header-anchor" href="#添加权限" aria-hidden="true">#</a> 添加权限</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token number">0b100</span>
<span class="token keyword">let</span> w <span class="token operator">=</span> <span class="token number">0b010</span>
<span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">0b001</span>

<span class="token keyword">let</span> user <span class="token operator">=</span> r <span class="token operator">|</span> w <span class="token operator">|</span> x 
user<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// output: &#39;111&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，执行 <code>r | w | x</code> 后，<code>user</code> 的三位都是 1，表明拥有了全部三个权限。</p><h3 id="校验权限" tabindex="-1"><a class="header-anchor" href="#校验权限" aria-hidden="true">#</a> 校验权限</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token number">0b100</span>
<span class="token keyword">let</span> w <span class="token operator">=</span> <span class="token number">0b010</span>
<span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">0b001</span>

<span class="token comment">// 给用户赋 r w 两个权限</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> r <span class="token operator">|</span> w <span class="token comment">// 0b110</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span>user <span class="token operator">&amp;</span> r<span class="token punctuation">)</span> <span class="token operator">===</span> r<span class="token punctuation">)</span> <span class="token comment">// true  有 r 权限</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span>user <span class="token operator">&amp;</span> w<span class="token punctuation">)</span> <span class="token operator">===</span> w<span class="token punctuation">)</span> <span class="token comment">// true  有 w 权限</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span>user <span class="token operator">&amp;</span> x<span class="token punctuation">)</span> <span class="token operator">===</span> x<span class="token punctuation">)</span> <span class="token comment">// false 没有 x 权限</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过<code>用户权限 &amp; 权限 code === 权限 code</code>就可以判断出用户是否拥有该权限。</p><h3 id="删除权限" tabindex="-1"><a class="header-anchor" href="#删除权限" aria-hidden="true">#</a> 删除权限</h3><blockquote><p>删除权限的本质其实是将指定位置上的 1 重置为 0。</p></blockquote><p>上个例子里用户权限是 <code>0b110</code>，拥有读和写两个权限，现在想删除读的权限，本质上就是将第三位的 1 重置为 0，变为 <code>0b010</code>。</p><p>使用 <code>&amp;(~code)</code>，对权限码先取反，再执行与操作，就可以删除权限：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token number">0b100</span>
<span class="token keyword">let</span> w <span class="token operator">=</span> <span class="token number">0b010</span>
<span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">0b001</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token number">0b110</span> <span class="token comment">// 有 r w 两个权限</span>

<span class="token comment">// 删除 r 权限</span>
user <span class="token operator">=</span> user <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token operator">~</span>r<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span>user <span class="token operator">&amp;</span> r<span class="token punctuation">)</span> <span class="token operator">===</span> r<span class="token punctuation">)</span> <span class="token comment">// false 没有 r 权限</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span>user <span class="token operator">&amp;</span> w<span class="token punctuation">)</span> <span class="token operator">===</span> w<span class="token punctuation">)</span> <span class="token comment">// true  有 w 权限</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span>user <span class="token operator">&amp;</span> x<span class="token punctuation">)</span> <span class="token operator">===</span> x<span class="token punctuation">)</span> <span class="token comment">// false 没有 x 权限</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 现在 user 是 0b010</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><h2 id="_5-局限性和解决办法" tabindex="-1"><a class="header-anchor" href="#_5-局限性和解决办法" aria-hidden="true">#</a> 5. 局限性和解决办法</h2><p>上面所有的操作，都基于两个前提：</p><ul><li><p>每个权限码都是唯一的。</p></li><li><p>每个权限码的二进制数形式，有且只有一位值为 1（<code>2^n</code>）。也就是说，权限码只能是 1，2，4，8，...，1024，...</p></li></ul><h3 id="局限性" tabindex="-1"><a class="header-anchor" href="#局限性" aria-hidden="true">#</a> 局限性</h3><p>JavaScript 数字的范围只能在 <code>-(2^53 - 1)</code> 和 <code>2^53 - 1</code> 之间，按位操作符又是将其操作数当作 32 位比特序列的。那么同一个应用下可用的权限数就非常有限了，这也是该方案的局限性。</p><h3 id="解决方法" tabindex="-1"><a class="header-anchor" href="#解决方法" aria-hidden="true">#</a> 解决方法</h3><p>为了突破这个限制，这里提出一个<strong>权限空间</strong>的概念，即权限数有限，那么不妨就多开辟几个空间来存放。</p><p>基于权限空间，我们定义两个格式：</p><ul><li><p>权限 code：字符串，形如 <code>&#39;index,pos&#39;</code>，例如 <code>&#39;0,1&#39;</code>，index 和 pos 使用英文逗号隔开。</p><blockquote><p>index 表示权限空间，用于突破 JavaScript 数字位数的限制，是从 0 开始的正整数，每个权限 code 都要归属于一个权限空间。</p></blockquote><blockquote><p>pos 表示 32 位二进制数中 1 的位置（其余全是 0）。</p></blockquote></li><li><p>用户权限：字符串，形如 <code>&#39;1,16,16&#39;</code>，英文逗号分隔每一个权限空间的权限值。</p><blockquote><p>例如：<code>1,16,16</code> 的意思就是：权限空间 0 的权限值是 1，权限空间 1 的权限值是 16，权限空间 2 的权限是 16。</p></blockquote></li></ul><details class="custom-container details"><summary>点击查看示例代码</summary><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 假设系统里有这些权限</span>
<span class="token comment">// 纯模拟，正常情况下是按顺序的，如 0,0 0,1 0,2 ... 尽可能占满一个权限空间，再使用下一个</span>
<span class="token keyword">const</span> permissions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">USER_ADD</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;0,0&quot;</span><span class="token punctuation">,</span> <span class="token comment">// index = 0, pos = 0</span>
    <span class="token literal-property property">info</span><span class="token operator">:</span> <span class="token string">&quot;用户新增权限&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token constant">USER_EDIT</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;0,8&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">info</span><span class="token operator">:</span> <span class="token string">&quot;用户编辑权限&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token constant">USER_VIEW</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;1,2&quot;</span><span class="token punctuation">,</span> <span class="token comment">// index = 1, pos = 2</span>
    <span class="token literal-property property">info</span><span class="token operator">:</span> <span class="token string">&quot;用户查看权限&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token constant">POST_EDIT</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;2,4&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">info</span><span class="token operator">:</span> <span class="token string">&quot;文章编辑权限&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 用户的权限 code</span>
<span class="token keyword">let</span> userCode <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>

<span class="token comment">// 添加权限</span>
<span class="token keyword">const</span> <span class="token function-variable function">addPermission</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">userCode<span class="token punctuation">,</span> permission</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> userPermission <span class="token operator">=</span> userCode <span class="token operator">?</span> userCode<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>index<span class="token punctuation">,</span> pos<span class="token punctuation">]</span> <span class="token operator">=</span> permission<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span>
  userPermission<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>userPermission<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">|</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> pos<span class="token punctuation">)</span>
  <span class="token keyword">return</span> userPermission<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 删除权限</span>
<span class="token keyword">const</span> <span class="token function-variable function">delPermission</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">userCode<span class="token punctuation">,</span> permission</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> userPermission <span class="token operator">=</span> userCode <span class="token operator">?</span> userCode<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>index<span class="token punctuation">,</span> pos<span class="token punctuation">]</span> <span class="token operator">=</span> permission<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span>
  userPermission<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>userPermission<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token operator">~</span>Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> userPermission<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 判断是否有权限</span>
<span class="token keyword">const</span> <span class="token function-variable function">hasPermission</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">userCode<span class="token punctuation">,</span> permission</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> userPermission <span class="token operator">=</span> userCode <span class="token operator">?</span> userCode<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>index<span class="token punctuation">,</span> pos<span class="token punctuation">]</span> <span class="token operator">=</span> permission<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> permissionValue <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> pos<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>userPermission<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">&amp;</span> permissionValue<span class="token punctuation">)</span> <span class="token operator">===</span> permissionValue
<span class="token punctuation">}</span>

userCode <span class="token operator">=</span> <span class="token function">addPermission</span><span class="token punctuation">(</span>userCode<span class="token punctuation">,</span> permissions<span class="token punctuation">.</span><span class="token constant">USER_EDIT</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><p>除了通过引入权限空间的概念突破二进制运算的位数限制，还可以使用 math.js 的 <code>bignumber</code>，直接运算超过 32 位的二进制数。</p><br><h2 id="_6-适用场景和问题" tabindex="-1"><a class="header-anchor" href="#_6-适用场景和问题" aria-hidden="true">#</a> 6. 适用场景和问题</h2><p>如果按照当前使用最广泛的 RBAC 模型设计权限系统，那么一般会有这么几个实体：应用、权限、角色、用户。</p><p>用户权限可以直接来自权限，也可以来自角色：一个应用下有多个权限，权限和角色是多对多的关系，用户和角色是多对多的关系，用户和权限是多对多的关系。</p><p>在此种模型下，一般会有 3 张对应关系表: 用户与权限、用户与角色、角色与权限。</p><p>想象一个商城后台权限管理系统，可能会有上万，甚至十几万店铺（应用），每个店铺可能会有数十个用户，角色，权限。随着业务的不断发展，刚才提到的那三张对应关系表会越来越大，越来越难以维护。</p><p>而进制转换的方法则可以省略对应关系表，减少查询，节省空间。当然，省略掉对应关系不是没有坏处的，例如下面几个问题：</p><ul><li>如何高效的查找我的权限？</li><li>如何高效的查找拥有某权限的所有用户？</li><li>如何控制权限的有效期？</li></ul><p>所以进制转换的方案比较适合刚才提到的应用极其多，而每个应用中用户，权限，角色数量较少的场景。</p><br><h2 id="_7-其他方案" tabindex="-1"><a class="header-anchor" href="#_7-其他方案" aria-hidden="true">#</a> 7. 其他方案</h2><p>除了二进制方案，当然还有其他方案可以达到类似的效果。例如：</p><ul><li><p>直接使用一个 1 和 0 组成的字符串，权限点对应 index，1 表示拥有权限，0 表示没有权限。</p><blockquote><p>添加 0、删除 1、编辑 2。用户 A 拥有添加和编辑的权限，则 userCode 为 101；用户 B 拥有全部权限，userCode 为 111。 这种方案比二进制转换简单，但是浪费空间。</p></blockquote></li><li><p>还有利用质数的方案，权限点全部为质数，用户权限为他所拥有的全部权限点的乘积。</p><blockquote><p>如：权限点是 2、3、5、7、11，用户权限是 5 * 7 * 11 = 385。 这种方案麻烦的地方在于获取质数（新增权限点）和质因数分解（判断权限），权限点特别多的时候就快成 RSA 了，如果只有增删改查个别几个权限，倒是可以考虑。</p></blockquote></li></ul><br><br><br><p>参考文章：</p><p><a href="https://segmentfault.com/a/1190000020930961" target="_blank" rel="noopener noreferrer">JavaScript 中的位运算和权限设计<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">最后更新时间: </span><!----></div><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.a35418cc.js" defer></script>
  </body>
</html>
